# vite-preact-multi-app
外部モジュールのインポートを持たないES Modules複数を単一リポジトリで管理したい.  

### どういうこと？
チャンクが生成されると扱いが厄介なので、チャンク分割を避けたい。

### 結論
Rollupにはチャンクなしにするオプションはない。Viteにもない。これはバンドルの最適化を目指して作られているからであるようだ。
https://github.com/rollup/rollup/issues/2756  

### 対策法
Viteを使ってビルドできるような回避策は一応ある。単一のoutputしかない時はチャンクが生成されないことを利用し、設定を1モジュールにつき一つ作成（ただしある程度共通化）してビルドを回せばよい。これをfor文とviteのbuild関数を使って実行するスクリプトを作成した。これでとりあえずはなんとかなる。

### 課題
Previewが綺麗にまとまらないかもしれない。Storybookにするときとかもこの構成だとうまくいかないので、なるべく共通のエコシステムの力を借りられるようにしておきたい。

### 展望
プロダクションビルドでchunk分割を避けたいというのが結局やりたいことなので、開発時は基本構成の力を最大限借りるように構成するのがよい。MPAを使ったHMRなどを活用できるようにすると良さそう。なるべくエコシステムと喧嘩しないような基本的な構成を採用し、プロダクションビルドの仕組みだけ切り出すのがよいと思われる。プロダクションビルドの構成をどこへ逃すかが課題になるが、個別の設定も共通の設定も出てきそうなのでmonorepo構成を採用しつつルート側に共通設定を集めるのが一番柔軟かもしれない。